import { Component, ContentChild, Input, ViewEncapsulation, } from '@angular/core';
import { Calendar } from '@fullcalendar/core';
import { CustomRenderingStore } from '@fullcalendar/core/internal';
import { OPTION_INPUT_NAMES, OPTION_IS_DEEP } from './options';
import { deepCopy, shallowCopy, mapHash } from './utils/obj';
import { deepEqual } from './utils/fast-deep-equal';
import * as i0 from "@angular/core";
import * as i1 from "./utils/offscreen-fragment.component";
import * as i2 from "./utils/transport-container.component";
import * as i3 from "@angular/common";
export class FullCalendarComponent {
    constructor(element, changeDetector) {
        this.element = element;
        this.calendar = null;
        this.optionSnapshot = {}; // for diffing
        this.customRenderingMap = new Map();
        this.templateMap = {};
        const customRenderingStore = new CustomRenderingStore();
        customRenderingStore.subscribe((customRenderingMap) => {
            this.customRenderingMap = customRenderingMap;
            this.customRenderingArray = undefined; // clear cache
            changeDetector.detectChanges();
        });
        this.handleCustomRendering = customRenderingStore.handle.bind(customRenderingStore);
        this.templateMap = this; // alias to this
    }
    ngAfterViewInit() {
        const { deepChangeDetection } = this;
        const options = {
            ...this.options,
            ...this.buildInputOptions(),
        };
        // initialize snapshot
        this.optionSnapshot = mapHash(options, (optionVal, optionName) => ((deepChangeDetection && OPTION_IS_DEEP[optionName])
            ? deepCopy(optionVal)
            : optionVal));
        this.calendar = new Calendar(this.element.nativeElement, {
            ...options,
            ...this.buildExtraOptions(),
        });
        this.calendar.render();
    }
    /*
    allows us to manually detect complex input changes, internal mutations to certain options.
    called before ngOnChanges. called much more often than ngOnChanges.
    */
    ngDoCheck() {
        if (this.calendar) { // not the initial render
            const { deepChangeDetection, optionSnapshot } = this;
            const newOptions = {
                ...this.options,
                ...this.buildInputOptions(),
            };
            const newProcessedOptions = {};
            let anyChanges = false;
            // detect adds and updates (and update snapshot)
            for (const optionName in newOptions) {
                if (newOptions.hasOwnProperty(optionName)) {
                    let optionVal = newOptions[optionName];
                    if (deepChangeDetection && OPTION_IS_DEEP[optionName]) {
                        if (!deepEqual(optionSnapshot[optionName], optionVal)) {
                            optionSnapshot[optionName] = deepCopy(optionVal);
                            anyChanges = true;
                            // trick FC into knowing about a nested change.
                            // TODO: future versions won't need this.
                            // can't use the previously-made deep copy because it blows away prototype-association.
                            optionVal = shallowCopy(optionVal);
                        }
                    }
                    else {
                        if (optionSnapshot[optionName] !== optionVal) {
                            optionSnapshot[optionName] = optionVal;
                            anyChanges = true;
                        }
                    }
                    newProcessedOptions[optionName] = optionVal;
                }
            }
            const oldOptionNames = Object.keys(optionSnapshot);
            // detect removals (and update snapshot)
            for (const optionName of oldOptionNames) {
                if (!(optionName in newOptions)) { // doesn't exist in new options?
                    delete optionSnapshot[optionName];
                    anyChanges = true;
                }
            }
            if (anyChanges) {
                this.calendar.pauseRendering();
                this.calendar.resetOptions({
                    ...newProcessedOptions,
                    ...this.buildExtraOptions(),
                });
            }
        }
    }
    ngAfterContentChecked() {
        if (this.calendar) { // too defensive?
            this.calendar.resumeRendering();
        }
    }
    ngOnDestroy() {
        if (this.calendar) { // too defensive?
            this.calendar.destroy();
            this.calendar = null;
        }
    }
    get customRenderings() {
        return this.customRenderingArray ||
            (this.customRenderingArray = [...this.customRenderingMap.values()]);
    }
    getApi() {
        return this.calendar;
    }
    buildInputOptions() {
        const options = {};
        for (const inputName of OPTION_INPUT_NAMES) {
            const inputValue = this[inputName];
            if (inputValue != null) { // exclude both null and undefined
                options[inputName] = inputValue;
            }
        }
        return options;
    }
    buildExtraOptions() {
        return {
            handleCustomRendering: this.handleCustomRendering,
            customRenderingMetaMap: this.templateMap,
            customRenderingReplacesEl: true,
        };
    }
}
FullCalendarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.3.12", ngImport: i0, type: FullCalendarComponent, deps: [{ token: i0.ElementRef }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
FullCalendarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.3.12", type: FullCalendarComponent, selector: "full-calendar", inputs: { options: "options", deepChangeDetection: "deepChangeDetection", events: "events", eventSources: "eventSources", resources: "resources" }, queries: [{ propertyName: "dayHeaderContent", first: true, predicate: ["dayHeaderContent"], descendants: true, static: true }, { propertyName: "dayCellContent", first: true, predicate: ["dayCellContent"], descendants: true, static: true }, { propertyName: "weekNumberContent", first: true, predicate: ["weekNumberContent"], descendants: true, static: true }, { propertyName: "nowIndicatorContent", first: true, predicate: ["nowIndicatorContent"], descendants: true, static: true }, { propertyName: "eventContent", first: true, predicate: ["eventContent"], descendants: true, static: true }, { propertyName: "slotLaneContent", first: true, predicate: ["slotLaneContent"], descendants: true, static: true }, { propertyName: "slotLabelContent", first: true, predicate: ["slotLabelContent"], descendants: true, static: true }, { propertyName: "allDayContent", first: true, predicate: ["allDayContent"], descendants: true, static: true }, { propertyName: "moreLinkContent", first: true, predicate: ["moreLinkContent"], descendants: true, static: true }, { propertyName: "noEventsContent", first: true, predicate: ["noEventsContent"], descendants: true, static: true }, { propertyName: "resourceAreaHeaderContent", first: true, predicate: ["resourceAreaHeaderContent"], descendants: true, static: true }, { propertyName: "resourceGroupLabelContent", first: true, predicate: ["resourceGroupLabelContent"], descendants: true, static: true }, { propertyName: "resourceLabelContent", first: true, predicate: ["resourceLabelContent"], descendants: true, static: true }, { propertyName: "resourceLaneContent", first: true, predicate: ["resourceLaneContent"], descendants: true, static: true }, { propertyName: "resourceGroupLaneContent", first: true, predicate: ["resourceGroupLaneContent"], descendants: true, static: true }], ngImport: i0, template: "<offscreen-fragment>\n  <transport-container *ngFor=\"let customRendering of customRenderings\"\n    [inPlaceOf]=\"customRendering.containerEl\"\n    [reportEl]=\"customRendering.reportNewContainerEl\"\n    [elTag]=\"customRendering.elTag\"\n    [elClasses]=\"customRendering.elClasses\"\n    [elStyle]=\"customRendering.elStyle\"\n    [elAttrs]=\"customRendering.elAttrs\"\n    [template]=\"templateMap[customRendering.generatorName]!\"\n    [renderProps]=\"customRendering.renderProps\"\n  ></transport-container>\n</offscreen-fragment>\n", components: [{ type: i1.OffscreenFragmentComponent, selector: "offscreen-fragment" }, { type: i2.TransportContainerComponent, selector: "transport-container", inputs: ["inPlaceOf", "reportEl", "elTag", "elClasses", "elStyle", "elAttrs", "template", "renderProps"] }], directives: [{ type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }], encapsulation: i0.ViewEncapsulation.None });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.3.12", ngImport: i0, type: FullCalendarComponent, decorators: [{
            type: Component,
            args: [{ selector: 'full-calendar', encapsulation: ViewEncapsulation.None // the styles are root-level, not scoped within the component
                    , template: "<offscreen-fragment>\n  <transport-container *ngFor=\"let customRendering of customRenderings\"\n    [inPlaceOf]=\"customRendering.containerEl\"\n    [reportEl]=\"customRendering.reportNewContainerEl\"\n    [elTag]=\"customRendering.elTag\"\n    [elClasses]=\"customRendering.elClasses\"\n    [elStyle]=\"customRendering.elStyle\"\n    [elAttrs]=\"customRendering.elAttrs\"\n    [template]=\"templateMap[customRendering.generatorName]!\"\n    [renderProps]=\"customRendering.renderProps\"\n  ></transport-container>\n</offscreen-fragment>\n" }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { options: [{
                type: Input
            }], deepChangeDetection: [{
                type: Input
            }], events: [{
                type: Input
            }], eventSources: [{
                type: Input
            }], resources: [{
                type: Input
            }], dayHeaderContent: [{
                type: ContentChild,
                args: ['dayHeaderContent', { static: true }]
            }], dayCellContent: [{
                type: ContentChild,
                args: ['dayCellContent', { static: true }]
            }], weekNumberContent: [{
                type: ContentChild,
                args: ['weekNumberContent', { static: true }]
            }], nowIndicatorContent: [{
                type: ContentChild,
                args: ['nowIndicatorContent', { static: true }]
            }], eventContent: [{
                type: ContentChild,
                args: ['eventContent', { static: true }]
            }], slotLaneContent: [{
                type: ContentChild,
                args: ['slotLaneContent', { static: true }]
            }], slotLabelContent: [{
                type: ContentChild,
                args: ['slotLabelContent', { static: true }]
            }], allDayContent: [{
                type: ContentChild,
                args: ['allDayContent', { static: true }]
            }], moreLinkContent: [{
                type: ContentChild,
                args: ['moreLinkContent', { static: true }]
            }], noEventsContent: [{
                type: ContentChild,
                args: ['noEventsContent', { static: true }]
            }], resourceAreaHeaderContent: [{
                type: ContentChild,
                args: ['resourceAreaHeaderContent', { static: true }]
            }], resourceGroupLabelContent: [{
                type: ContentChild,
                args: ['resourceGroupLabelContent', { static: true }]
            }], resourceLabelContent: [{
                type: ContentChild,
                args: ['resourceLabelContent', { static: true }]
            }], resourceLaneContent: [{
                type: ContentChild,
                args: ['resourceLaneContent', { static: true }]
            }], resourceGroupLaneContent: [{
                type: ContentChild,
                args: ['resourceGroupLaneContent', { static: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZnVsbC1jYWxlbmRhci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9saWIvc3JjL2Z1bGwtY2FsZW5kYXIuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vbGliL3NyYy9mdWxsLWNhbGVuZGFyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsWUFBWSxFQUdaLEtBQUssRUFLTCxpQkFBaUIsR0FFbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFFBQVEsRUFBbUIsTUFBTSxvQkFBb0IsQ0FBQztBQUMvRCxPQUFPLEVBQW1CLG9CQUFvQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDcEYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLGNBQWMsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUUvRCxPQUFPLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDN0QsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHlCQUF5QixDQUFDOzs7OztBQU9wRCxNQUFNLE9BQU8scUJBQXFCO0lBc0NoQyxZQUNVLE9BQW1CLEVBQzNCLGNBQWlDO1FBRHpCLFlBQU8sR0FBUCxPQUFPLENBQVk7UUFSckIsYUFBUSxHQUFvQixJQUFJLENBQUM7UUFDakMsbUJBQWMsR0FBd0IsRUFBRSxDQUFDLENBQUMsY0FBYztRQUV4RCx1QkFBa0IsR0FBRyxJQUFJLEdBQUcsRUFBZ0MsQ0FBQTtRQUU3RCxnQkFBVyxHQUFpRCxFQUFFLENBQUE7UUFNbkUsTUFBTSxvQkFBb0IsR0FBRyxJQUFJLG9CQUFvQixFQUFFLENBQUM7UUFFeEQsb0JBQW9CLENBQUMsU0FBUyxDQUFDLENBQUMsa0JBQWtCLEVBQUUsRUFBRTtZQUNwRCxJQUFJLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7WUFDN0MsSUFBSSxDQUFDLG9CQUFvQixHQUFHLFNBQVMsQ0FB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QUFFLElBQUksRUFBRTtnQkFDRCxhQUFhO3NCQUE3RCxZQUFZO3VCQUFDLGVBQWUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBQ0ksZUFBZTtzQkFBakUsWUFBWTt1QkFBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBQ0UsZUFBZTtzQkFBakUsWUFBWTt1QkFBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBQ1kseUJBQXlCO3NCQUFyRixZQUFZO3VCQUFDLDJCQUEyQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtnQkFDRSx5QkFBeUI7c0JBQXJGLFlBQVk7dUJBQUMsMkJBQTJCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFO2dCQUNILG9CQUFvQjtzQkFBM0UsWUFBWTt1QkFBQyxzQkFBc0IsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7Z0JBQ0MsbUJBQW1CO3NCQUF6RSxZQUFZO3VCQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtnQkFDTyx3QkFBd0I7c0JBQW5GLFlBQVk7dUJBQUMsMEJBQTBCLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBDb250ZW50Q2hpbGQsXG4gIFRlbXBsYXRlUmVmLFxuICBFbGVtZW50UmVmLFxuICBJbnB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgRG9DaGVjayxcbiAgQWZ0ZXJDb250ZW50Q2hlY2tlZCxcbiAgT25EZXN0cm95LFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ2FsZW5kYXIsIENhbGVuZGFyT3B0aW9ucyB9IGZyb20gJ0BmdWxsY2FsZW5kYXIvY29yZSc7XG5pbXBvcnQgeyBDdXN0b21SZW5kZXJpbmcsIEN1c3RvbVJlbmRlcmluZ1N0b3JlIH0gZnJvbSAnQGZ1bGxjYWxlbmRhci9jb3JlL2ludGVybmFsJztcbmltcG9ydCB7IE9QVElPTl9JTlBVVF9OQU1FUywgT1BUSU9OX0lTX0RFRVAgfSBmcm9tICcuL29wdGlvbnMnO1xuaW1wb3J0IHsgQ2FsZW5kYXJPcHRpb24sIENhbGVuZGFyVGVtcGxhdGVSZWYgfSBmcm9tICcuL3ByaXZhdGUtdHlwZXMnO1xuaW1wb3J0IHsgZGVlcENvcHksIHNoYWxsb3dDb3B5LCBtYXBIYXNoIH0gZnJvbSAnLi91dGlscy9vYmonO1xuaW1wb3J0IHsgZGVlcEVxdWFsIH0gZnJvbSAnLi91dGlscy9mYXN0LWRlZXAtZXF1YWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdmdWxsLWNhbGVuZGFyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2Z1bGwtY2FsZW5kYXIuY29tcG9uZW50Lmh0bWwnLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lIC8vIHRoZSBzdHlsZXMgYXJlIHJvb3QtbGV2ZWwsIG5vdCBzY29wZWQgd2l0aGluIHRoZSBjb21wb25lbnRcbn0pXG5leHBvcnQgY2xhc3MgRnVsbENhbGVuZGFyQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCwgRG9DaGVjaywgQWZ0ZXJDb250ZW50Q2hlY2tlZCwgT25EZXN0cm95IHtcbiAgQElucHV0KCkgb3B0aW9ucz86IENhbGVuZGFyT3B0aW9ucztcbiAgQElucHV0KCkgZGVlcENoYW5nZURldGVjdGlvbj86IGJvb2xlYW47XG5cbiAgLypcbiAgT3B0aW9ucyBhcyBpbmRpdmlkdWFsIElucHV0c1xuICBOT1RFOiBrZWVwIGluIHN5bmMgd2l0aCBPUFRJT05fSU5QVVRfTkFNRVNcbiAgKi9cbiAgQElucHV0KCkgZXZlbnRzPzogQ2FsZW5kYXJPcHRpb248J2V2ZW50cyc+IHwgbnVsbCB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgZXZlbnRTb3VyY2VzPzogQ2FsZW5kYXJPcHRpb248J2V2ZW50U291cmNlcyc+IHwgbnVsbCB8IHVuZGVmaW5lZDtcbiAgQElucHV0KCkgcmVzb3VyY2VzPzogQ2FsZW5kYXJPcHRpb248J3Jlc291cmNlcyc+IHwgbnVsbCB8IHVuZGVmaW5lZDtcblxuICAvKlxuICBUZW1wbGF0ZXNcbiAgKi9cbiAgQENvbnRlbnRDaGlsZCgnZGF5SGVhZGVyQ29udGVudCcsIHsgc3RhdGljOiB0cnVlIH0pIGRheUhlYWRlckNvbnRlbnQ/OiBDYWxlbmRhclRlbXBsYXRlUmVmPCdkYXlIZWFkZXJDb250ZW50Jz47XG4gIEBDb250ZW50Q2hpbGQoJ2RheUNlbGxDb250ZW50JywgeyBzdGF0aWM6IHRydWUgfSkgZGF5Q2VsbENvbnRlbnQ/OiBDYWxlbmRhclRlbXBsYXRlUmVmPCdkYXlDZWxsQ29udGVudCc+O1xuICBAQ29udGVudENoaWxkKCd3ZWVrTnVtYmVyQ29udGVudCcsIHsgc3RhdGljOiB0cnVlIH0pIHdlZWtOdW1iZXJDb250ZW50PzogQ2FsZW5kYXJUZW1wbGF0ZVJlZjwnd2Vla051bWJlckNvbnRlbnQnPjtcbiAgQENvbnRlbnRDaGlsZCgnbm93SW5kaWNhdG9yQ29udGVudCcsIHsgc3RhdGljOiB0cnVlIH0pIG5vd0luZGljYXRvckNvbnRlbnQ/OiBDYWxlbmRhclRlbXBsYXRlUmVmPCdub3dJbmRpY2F0b3JDb250ZW50Jz47XG4gIEBDb250ZW50Q2hpbGQoJ2V2ZW50Q29udGVudCcsIHsgc3RhdGljOiB0cnVlIH0pIGV2ZW50Q29udGVudD86IENhbGVuZGFyVGVtcGxhdGVSZWY8J2V2ZW50Q29udGVudCc+O1xuICBAQ29udGVudENoaWxkKCdzbG90TGFuZUNvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBzbG90TGFuZUNvbnRlbnQ/OiBDYWxlbmRhclRlbXBsYXRlUmVmPCdzbG90TGFuZUNvbnRlbnQnPjtcbiAgQENvbnRlbnRDaGlsZCgnc2xvdExhYmVsQ29udGVudCcsIHsgc3RhdGljOiB0cnVlIH0pIHNsb3RMYWJlbENvbnRlbnQ/OiBDYWxlbmRhclRlbXBsYXRlUmVmPCdzbG90TGFiZWxDb250ZW50Jz47XG4gIEBDb250ZW50Q2hpbGQoJ2FsbERheUNvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBhbGxEYXlDb250ZW50PzogQ2FsZW5kYXJUZW1wbGF0ZVJlZjwnYWxsRGF5Q29udGVudCc+O1xuICBAQ29udGVudENoaWxkKCdtb3JlTGlua0NvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBtb3JlTGlua0NvbnRlbnQ/OiBDYWxlbmRhclRlbXBsYXRlUmVmPCdtb3JlTGlua0NvbnRlbnQnPjtcbiAgQENvbnRlbnRDaGlsZCgnbm9FdmVudHNDb250ZW50JywgeyBzdGF0aWM6IHRydWUgfSkgbm9FdmVudHNDb250ZW50PzogQ2FsZW5kYXJUZW1wbGF0ZVJlZjwnbm9FdmVudHNDb250ZW50Jz47XG4gIEBDb250ZW50Q2hpbGQoJ3Jlc291cmNlQXJlYUhlYWRlckNvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSByZXNvdXJjZUFyZWFIZWFkZXJDb250ZW50PzogQ2FsZW5kYXJUZW1wbGF0ZVJlZjwncmVzb3VyY2VBcmVhSGVhZGVyQ29udGVudCc+O1xuICBAQ29udGVudENoaWxkKCdyZXNvdXJjZUdyb3VwTGFiZWxDb250ZW50JywgeyBzdGF0aWM6IHRydWUgfSkgcmVzb3VyY2VHcm91cExhYmVsQ29udGVudD86IENhbGVuZGFyVGVtcGxhdGVSZWY8J3Jlc291cmNlR3JvdXBMYWJlbENvbnRlbnQnPjtcbiAgQENvbnRlbnRDaGlsZCgncmVzb3VyY2VMYWJlbENvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSByZXNvdXJjZUxhYmVsQ29udGVudD86IENhbGVuZGFyVGVtcGxhdGVSZWY8J3Jlc291cmNlTGFiZWxDb250ZW50Jz47XG4gIEBDb250ZW50Q2hpbGQoJ3Jlc291cmNlTGFuZUNvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSByZXNvdXJjZUxhbmVDb250ZW50PzogQ2FsZW5kYXJUZW1wbGF0ZVJlZjwncmVzb3VyY2VMYW5lQ29udGVudCc+O1xuICBAQ29udGVudENoaWxkKCdyZXNvdXJjZUdyb3VwTGFuZUNvbnRlbnQnLCB7IHN0YXRpYzogdHJ1ZSB9KSByZXNvdXJjZUdyb3VwTGFuZUNvbnRlbnQ/OiBDYWxlbmRhclRlbXBsYXRlUmVmPCdyZXNvdXJjZUdyb3VwTGFuZUNvbnRlbnQnPjtcblxuICBwcml2YXRlIGNhbGVuZGFyOiBDYWxlbmRhciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIG9wdGlvblNuYXBzaG90OiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307IC8vIGZvciBkaWZmaW5nXG4gIHByaXZhdGUgaGFuZGxlQ3VzdG9tUmVuZGVyaW5nOiAoY3VzdG9tUmVuZGVyaW5nOiBDdXN0b21SZW5kZXJpbmc8YW55PikgPT4gdm9pZFxuICBwcml2YXRlIGN1c3RvbVJlbmRlcmluZ01hcCA9IG5ldyBNYXA8c3RyaW5nLCBDdXN0b21SZW5kZXJpbmc8YW55Pj4oKVxuICBwcml2YXRlIGN1c3RvbVJlbmRlcmluZ0FycmF5PzogQ3VzdG9tUmVuZGVyaW5nPGFueT5bXVxuICBwdWJsaWMgdGVtcGxhdGVNYXA6IHsgW3RlbXBsYXRlTmFtZTogc3RyaW5nXTogVGVtcGxhdGVSZWY8YW55PiB9ID0ge31cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGVsZW1lbnQ6IEVsZW1lbnRSZWYsXG4gICAgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmXG4gICkge1xuICAgIGNvbnN0IGN1c3RvbVJlbmRlcmluZ1N0b3JlID0gbmV3IEN1c3RvbVJlbmRlcmluZ1N0b3JlKCk7XG5cbiAgICBjdXN0b21SZW5kZXJpbmdTdG9yZS5zdWJzY3JpYmUoKGN1c3RvbVJlbmRlcmluZ01hcCkgPT4ge1xuICAgICAgdGhpcy5jdXN0b21SZW5kZXJpbmdNYXAgPSBjdXN0b21SZW5kZXJpbmdNYXA7XG4gICAgICB0aGlzLmN1c3RvbVJlbmRlcmluZ0FycmF5ID0gdW5kZWZpbmVkOyAvLyBjbGVhciBjYWNoZVxuICAgICAgY2hhbmdlRGV0ZWN0b3IuZGV0ZWN0Q2hhbmdlcygpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5oYW5kbGVDdXN0b21SZW5kZXJpbmcgPSBjdXN0b21SZW5kZXJpbmdTdG9yZS5oYW5kbGUuYmluZChjdXN0b21SZW5kZXJpbmdTdG9yZSk7XG4gICAgdGhpcy50ZW1wbGF0ZU1hcCA9IHRoaXMgYXMgYW55OyAvLyBhbGlhcyB0byB0aGlzXG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgY29uc3QgeyBkZWVwQ2hhbmdlRGV0ZWN0aW9uIH0gPSB0aGlzO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAuLi50aGlzLm9wdGlvbnMsXG4gICAgICAuLi50aGlzLmJ1aWxkSW5wdXRPcHRpb25zKCksXG4gICAgfTtcblxuICAgIC8vIGluaXRpYWxpemUgc25hcHNob3RcbiAgICB0aGlzLm9wdGlvblNuYXBzaG90ID0gbWFwSGFzaChvcHRpb25zLCAob3B0aW9uVmFsOiBhbnksIG9wdGlvbk5hbWU6IHN0cmluZykgPT4gKFxuICAgICAgKGRlZXBDaGFuZ2VEZXRlY3Rpb24gJiYgT1BUSU9OX0lTX0RFRVBbb3B0aW9uTmFtZV0pXG4gICAgICAgID8gZGVlcENvcHkob3B0aW9uVmFsKVxuICAgICAgICA6IG9wdGlvblZhbFxuICAgICkpO1xuXG4gICAgdGhpcy5jYWxlbmRhciA9IG5ldyBDYWxlbmRhcih0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCwge1xuICAgICAgLi4ub3B0aW9ucyxcbiAgICAgIC4uLnRoaXMuYnVpbGRFeHRyYU9wdGlvbnMoKSxcbiAgICB9KTtcbiAgICB0aGlzLmNhbGVuZGFyLnJlbmRlcigpO1xuICB9XG5cbiAgLypcbiAgYWxsb3dzIHVzIHRvIG1hbnVhbGx5IGRldGVjdCBjb21wbGV4IGlucHV0IGNoYW5nZXMsIGludGVybmFsIG11dGF0aW9ucyB0byBjZXJ0YWluIG9wdGlvbnMuXG4gIGNhbGxlZCBiZWZvcmUgbmdPbkNoYW5nZXMuIGNhbGxlZCBtdWNoIG1vcmUgb2Z0ZW4gdGhhbiBuZ09uQ2hhbmdlcy5cbiAgKi9cbiAgbmdEb0NoZWNrKCkge1xuICAgIGlmICh0aGlzLmNhbGVuZGFyKSB7IC8vIG5vdCB0aGUgaW5pdGlhbCByZW5kZXJcbiAgICAgIGNvbnN0IHsgZGVlcENoYW5nZURldGVjdGlvbiwgb3B0aW9uU25hcHNob3QgfSA9IHRoaXM7XG4gICAgICBjb25zdCBuZXdPcHRpb25zID0ge1xuICAgICAgICAuLi50aGlzLm9wdGlvbnMsXG4gICAgICAgIC4uLnRoaXMuYnVpbGRJbnB1dE9wdGlvbnMoKSxcbiAgICAgIH07XG4gICAgICBjb25zdCBuZXdQcm9jZXNzZWRPcHRpb25zOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG4gICAgICBsZXQgYW55Q2hhbmdlcyA9IGZhbHNlO1xuXG4gICAgICAvLyBkZXRlY3QgYWRkcyBhbmQgdXBkYXRlcyAoYW5kIHVwZGF0ZSBzbmFwc2hvdClcbiAgICAgIGZvciAoY29uc3Qgb3B0aW9uTmFtZSBpbiBuZXdPcHRpb25zKSB7XG4gICAgICAgIGlmIChuZXdPcHRpb25zLmhhc093blByb3BlcnR5KG9wdGlvbk5hbWUpKSB7XG4gICAgICAgICAgbGV0IG9wdGlvblZhbCA9IG5ld09wdGlvbnNbb3B0aW9uTmFtZSBhcyBrZXlvZiBDYWxlbmRhck9wdGlvbnNdO1xuXG4gICAgICAgICAgaWYgKGRlZXBDaGFuZ2VEZXRlY3Rpb24gJiYgT1BUSU9OX0lTX0RFRVBbb3B0aW9uTmFtZV0pIHtcbiAgICAgICAgICAgIGlmICghZGVlcEVxdWFsKG9wdGlvblNuYXBzaG90W29wdGlvbk5hbWVdLCBvcHRpb25WYWwpKSB7XG4gICAgICAgICAgICAgIG9wdGlvblNuYXBzaG90W29wdGlvbk5hbWVdID0gZGVlcENvcHkob3B0aW9uVmFsKTtcbiAgICAgICAgICAgICAgYW55Q2hhbmdlcyA9IHRydWU7XG5cbiAgICAgICAgICAgICAgLy8gdHJpY2sgRkMgaW50byBrbm93aW5nIGFib3V0IGEgbmVzdGVkIGNoYW5nZS5cbiAgICAgICAgICAgICAgLy8gVE9ETzogZnV0dXJlIHZlcnNpb25zIHdvbid0IG5lZWQgdGhpcy5cbiAgICAgICAgICAgICAgLy8gY2FuJ3QgdXNlIHRoZSBwcmV2aW91c2x5LW1hZGUgZGVlcCBjb3B5IGJlY2F1c2UgaXQgYmxvd3MgYXdheSBwcm90b3R5cGUtYXNzb2NpYXRpb24uXG4gICAgICAgICAgICAgIG9wdGlvblZhbCA9IHNoYWxsb3dDb3B5KG9wdGlvblZhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChvcHRpb25TbmFwc2hvdFtvcHRpb25OYW1lXSAhPT0gb3B0aW9uVmFsKSB7XG4gICAgICAgICAgICAgIG9wdGlvblNuYXBzaG90W29wdGlvbk5hbWVdID0gb3B0aW9uVmFsO1xuICAgICAgICAgICAgICBhbnlDaGFuZ2VzID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBuZXdQcm9jZXNzZWRPcHRpb25zW29wdGlvbk5hbWVdID0gb3B0aW9uVmFsO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG9sZE9wdGlvbk5hbWVzID0gT2JqZWN0LmtleXMob3B0aW9uU25hcHNob3QpO1xuXG4gICAgICAvLyBkZXRlY3QgcmVtb3ZhbHMgKGFuZCB1cGRhdGUgc25hcHNob3QpXG4gICAgICBmb3IgKGNvbnN0IG9wdGlvbk5hbWUgb2Ygb2xkT3B0aW9uTmFtZXMpIHtcbiAgICAgICAgaWYgKCEob3B0aW9uTmFtZSBpbiBuZXdPcHRpb25zKSkgeyAvLyBkb2Vzbid0IGV4aXN0IGluIG5ldyBvcHRpb25zP1xuICAgICAgICAgIGRlbGV0ZSBvcHRpb25TbmFwc2hvdFtvcHRpb25OYW1lXTtcbiAgICAgICAgICBhbnlDaGFuZ2VzID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoYW55Q2hhbmdlcykge1xuICAgICAgICB0aGlzLmNhbGVuZGFyLnBhdXNlUmVuZGVyaW5nKCk7XG4gICAgICAgIHRoaXMuY2FsZW5kYXIucmVzZXRPcHRpb25zKHtcbiAgICAgICAgICAuLi5uZXdQcm9jZXNzZWRPcHRpb25zLFxuICAgICAgICAgIC4uLnRoaXMuYnVpbGRFeHRyYU9wdGlvbnMoKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRDaGVja2VkKCkge1xuICAgIGlmICh0aGlzLmNhbGVuZGFyKSB7IC8vIHRvbyBkZWZlbnNpdmU/XG4gICAgICB0aGlzLmNhbGVuZGFyLnJlc3VtZVJlbmRlcmluZygpO1xuICAgIH1cbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmNhbGVuZGFyKSB7IC8vIHRvbyBkZWZlbnNpdmU/XG4gICAgICB0aGlzLmNhbGVuZGFyLmRlc3Ryb3koKTtcbiAgICAgIHRoaXMuY2FsZW5kYXIgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGdldCBjdXN0b21SZW5kZXJpbmdzKCk6IEN1c3RvbVJlbmRlcmluZzxhbnk+W10ge1xuICAgIHJldHVybiB0aGlzLmN1c3RvbVJlbmRlcmluZ0FycmF5IHx8XG4gICAgICAodGhpcy5jdXN0b21SZW5kZXJpbmdBcnJheSA9IFsuLi50aGlzLmN1c3RvbVJlbmRlcmluZ01hcC52YWx1ZXMoKV0pO1xuICB9XG5cbiAgcHVibGljIGdldEFwaSgpOiBDYWxlbmRhciB7XG4gICAgcmV0dXJuIHRoaXMuY2FsZW5kYXIhO1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZElucHV0T3B0aW9ucygpOiBDYWxlbmRhck9wdGlvbnMge1xuICAgIGNvbnN0IG9wdGlvbnM6IENhbGVuZGFyT3B0aW9ucyA9IHt9XG5cbiAgICBmb3IgKGNvbnN0IGlucHV0TmFtZSBvZiBPUFRJT05fSU5QVVRfTkFNRVMpIHtcbiAgICAgIGNvbnN0IGlucHV0VmFsdWUgPSAodGhpcyBhcyBhbnkpW2lucHV0TmFtZV07XG5cbiAgICAgIGlmIChpbnB1dFZhbHVlICE9IG51bGwpIHsgLy8gZXhjbHVkZSBib3RoIG51bGwgYW5kIHVuZGVmaW5lZFxuICAgICAgICAob3B0aW9ucyBhcyBhbnkpW2lucHV0TmFtZV0gPSBpbnB1dFZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBvcHRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBidWlsZEV4dHJhT3B0aW9ucygpOiBDYWxlbmRhck9wdGlvbnMge1xuICAgIHJldHVybiB7XG4gICAgICBoYW5kbGVDdXN0b21SZW5kZXJpbmc6IHRoaXMuaGFuZGxlQ3VzdG9tUmVuZGVyaW5nLFxuICAgICAgY3VzdG9tUmVuZGVyaW5nTWV0YU1hcDogdGhpcy50ZW1wbGF0ZU1hcCxcbiAgICAgIGN1c3RvbVJlbmRlcmluZ1JlcGxhY2VzRWw6IHRydWUsXG4gICAgfTtcbiAgfVxufVxuIiwiPG9mZnNjcmVlbi1mcmFnbWVudD5cbiAgPHRyYW5zcG9ydC1jb250YWluZXIgKm5nRm9yPVwibGV0IGN1c3RvbVJlbmRlcmluZyBvZiBjdXN0b21SZW5kZXJpbmdzXCJcbiAgICBbaW5QbGFjZU9mXT1cImN1c3RvbVJlbmRlcmluZy5jb250YWluZXJFbFwiXG4gICAgW3JlcG9ydEVsXT1cImN1c3RvbVJlbmRlcmluZy5yZXBvcnROZXdDb250YWluZXJFbFwiXG4gICAgW2VsVGFnXT1cImN1c3RvbVJlbmRlcmluZy5lbFRhZ1wiXG4gICAgW2VsQ2xhc3Nlc109XCJjdXN0b21SZW5kZXJpbmcuZWxDbGFzc2VzXCJcbiAgICBbZWxTdHlsZV09XCJjdXN0b21SZW5kZXJpbmcuZWxTdHlsZVwiXG4gICAgW2VsQXR0cnNdPVwiY3VzdG9tUmVuZGVyaW5nLmVsQXR0cnNcIlxuICAgIFt0ZW1wbGF0ZV09XCJ0ZW1wbGF0ZU1hcFtjdXN0b21SZW5kZXJpbmcuZ2VuZXJhdG9yTmFtZV0hXCJcbiAgICBbcmVuZGVyUHJvcHNdPVwiY3VzdG9tUmVuZGVyaW5nLnJlbmRlclByb3BzXCJcbiAgPjwvdHJhbnNwb3J0LWNvbnRhaW5lcj5cbjwvb2Zmc2NyZWVuLWZyYWdtZW50PlxuIl19